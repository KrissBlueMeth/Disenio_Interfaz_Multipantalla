<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bienvenida - Tu Entorno</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* CSS DINÁMICO: Definimos el tema oscuro que se activara por JS */
        body.dark-mode { 
            background-color: #121212 !important;
            color: #ffffff !important; 
        }
        .dark-mode .card { 
            background-color: #1e1e1e; 
            border-color: #333; 
            color: white; 
        }
        
        /* VISIBILIDAD DEL SISTEMA: Estilo para la pantalla de carga (Loader) */
        #cargador {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-light">

    <div id="cargador">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
        <p class="mt-3 fw-bold">Cargando tu configuración personalizada...</p>
    </div>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-8 text-center">
                <div class="card p-5">
                    <h1 id="bienvenida" class="display-4"></h1>
                    <p class="lead mt-3">Este es la configuración aplicada en tu entorno.</p>
                    
                    <div class="d-grid gap-3 d-md-block mt-4">
                        <button class="btn btn-secondary btn-lg px-5" onclick="window.location.href='index.html'">
                            CAMBIAR CONFIGURACIÓN
                        </button>
                        <button class="btn btn-info btn-lg px-5 text-white" data-bs-toggle="modal" data-bs-target="#ayudaModal">
                            AYUDA
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="ayudaModal" tabindex="-1" aria-labelledby="ayudaModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content text-dark">
                <div class="modal-header">
                    <h5 class="modal-title" id="ayudaModalLabel">Soporte Técnico</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Instrucciones de recuperación:</strong></p>
                    <ul>
                        <li>Para cambiar el tema, use el botón "Cambiar Configuración".</li>
                        <li>Los datos residen en el almacenamiento local del navegador (LocalStorage).</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // LÓGICA DE CARGA Y APLICACIÓN DE DATOS
        window.onload = function() {
            // Recuperamos y decodificamos el objeto JSON guardado anteriormente
            const config = JSON.parse(localStorage.getItem('formulario'));
            const primeraCarga = sessionStorage.getItem('enCarga');

            // Seguridad: Si no hay datos, devolvemos al usuario al inicio
            if (!config) {
                window.location.href = 'index.html';
                return;
            }

            // RECUPERACIÓN DE DATOS: Aplicamos el nombre y el tamaño de fuente elegido
            document.getElementById('bienvenida').innerText = `¡Hola, ${config.nombre}!`;
            document.getElementById('bienvenida').style.fontSize = config.fuenteS + 'px';
            
            // APLICACIÓN DE TEMA: Si el usuario eligió 'dark', añadimos la clase CSS al body
            if (config.modo === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('cargador').style.background = '#121212'; // Ajuste estético del loader
            }

            // GESTIÓN DEL FEEDBACK (Visibilidad):
            // Si venimos de la pantalla 1 (donde enCarga era true), simulamos carga de 1.5s
            if (primeraCarga === 'true') {
                setTimeout(() => {
                    document.getElementById('cargador').classList.add('hidden');
                    sessionStorage.removeItem('enCarga'); // Limpiamos para que no salga al refrescar
                }, 1500);
            } else {
                // Si el usuario simplemente refrescó la página, ocultamos el cargador inmediatamente
                document.getElementById('cargador').classList.add('hidden');
            }
        };
    </script>
</body>
</html>